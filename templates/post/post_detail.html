{% extends 'base.html' %}
{% load crispy_forms_filters %}
{% load humanize %}

{% block content %}

    <div class="container list-group-item">
        <a class="list-group-item" href="{% url 'profile' post.user.username %}"><h5 class="mb-1">
            @{{ post.user.username }}</h5></a>
        <div class="d-flex w-100 justify-content-between">
            <small class="text-muted">{{ post.posted|naturaltime }}</small>
        </div>
        <p class="mb-1"><img src="{{ post.picture.url }}" alt=""></p>
        <p class="mb-1">{{ post.caption }}</p>
        <div>
            <div>
                {% for tag in post.tags.all %}
                    <a href="{{ tag.get_absolute_url }}">{{ tag }}</a>
                {% endfor %}
            </div>
            <a class="link-danger" href="{% url 'post_like' post.id %}">
                <small>{{ post.likes }} Likes</small>
            </a>
            {% if post.user == request.user %}
                <a href="{% url 'post_delete' post.id %}">Delete</a>
            {% endif %}
        </div>

        <div class="row">
            <div class="col-1 mt-4">
                {% if request.user.profile.picture %}
                    <img src="{{ request.user.profile.picture.url }}" width="50" alt="">
                {% else %}
                    <img src="https://via.placeholder.com/50" alt="">
                {% endif %}
            </div>
            <div class="col-11">
                <form action="" method="post" role="form">
                    {% csrf_token %}
                    <div>
                        <p>
                            {{ form.body|as_crispy_field }}
                        </p>
                        <button type="submit" name="action" class="btn btn-info">
                            Post comment
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <ul class="list-group mb-3">
            {% for comment in comments %}
                <li class="list-group-item mt-2">
                    <div class="row">
                        <div class="col-1">
                            {% if comment.user.profile.picture %}
                                <img src="{{ comment.user.profile.picture.url }}" width="64" alt="">
                            {% else %}
                                <img src="https://via.placeholder.com/50" alt="">
                            {% endif %}
                        </div>
                        <div class="col-8">
                            {% if comment.user.profile.first_name %}
                                <p>{{ comment.user.profile.first_name }}</p>
                            {% else %}
                                <p>Unknown</p>
                            {% endif %}
                            <br>
                            {{ comment.body }}
                            <br>
                            {{ comment.date }}
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>

{% endblock content %}